<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

    <h1>AJAX</h1>

    <input type="file" id="new_avatar">

    <hr>

    <img src="" alt="" width="100" id="avatar">


    <script>

    let newAvatarElement = document.querySelector('#new_avatar');
    let avatarElement = document.querySelector('#avatar');

    newAvatarElement.onchange = function() {

        console.log(this.files)

        let xhr = new XMLHttpRequest();

        xhr.open('post', '/avatar');

        xhr.onload = function() {
            // console.log(this.responseText);

            let res = JSON.parse(this.responseText);

            console.log(res)

            avatarElement.src = '/' + res.data;
        }

        let fd = new FormData();
        // fd.append('avatar', this.value);
        fd.append('avatar', this.files[0]);
        xhr.send(fd);
    }

    </script>

</body>
</html>
